<div id="badges">
  <a href="https://www.linkedin.com/in/vasilev-vitalii/">
    <img src="https://img.shields.io/badge/LinkedIn-blue?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn Badge"/>
  </a>
  <a href="https://www.youtube.com/@user-gj9vk5ln5c/featured">
    <img src="https://img.shields.io/badge/YouTube-red?style=for-the-badge&logo=youtube&logoColor=white" alt="Youtube Badge"/>
  </a>
</div>

[English](README.md)

# mentator-ddl-creator

**mentator-ddl-creator** — это утилита для генерации DDL-скриптов и скриптов заполнения данных для баз данных ORACLE или MSSQL (в будущем планируется добавить режимы работы для POSTGRESQL). Утилита позволяет гибко настраивать, какие объекты и данные выгружать, а также поддерживает как полное, так и частичное заполнение таблиц.

## Основные возможности

* Генерация DDL-скриптов для различных объектов базы данных (таблицы, представления, индексы, процедуры, пакеты и др.)
* Генерация скриптов полного или частичного заполнения таблиц данными (INSERT)
* Гибкая настройка через конфигурационный файл (JSONC)
* Шифрование пароля для хранения в настройках

## Режимы работы

#### Генерация шаблона конфигурационного файла
Создаёт пример файла настроек (JSONC), который можно отредактировать под свои задачи.

Для ORACLE:
```bash
mentator-ddl-creator --conf-gen-ora /path/to/dir
```
Для MSSQL:
```bash
mentator-ddl-creator --conf-gen-mssql /path/to/dir
```

#### Шифрование пароля для подключения к БД (необязательно)
```bash
mentator-ddl-creator --crypt ваш_пароль
```
Возвращает зашифрованный пароль, который можно безопасно использовать в конфиге. **Внимание!** Это больше защита от дурака, чем от опытного хакера.

#### Основной режим - генерация DDL и скриптов данных по конфигу
```bash
mentator-ddl-creator --conf-use /path/to/your/config.jsonc
```
Читает файл настроек и генерирует скрипты согласно описанным в нём правилам.

## Быстрый старт

1. #### Запустите генерацию файла настроек
Для ORACLE:
```bash
mentator-ddl-creator --conf-gen-ora ./
```
Для MSSQL:
```bash
mentator-ddl-creator --conf-gen-mssql ./
```

2. #### Откройте созданный файл vv-ddl-get.config.TEMPLATE.ORA.jsonc (или vv-ddl-get.config.TEMPLATE.MSSQL.jsonc), в нем
    * Замените все вхождения подстроки 'path/to/' на подстроку './'
    * **Пользователям Windows:** Если параметр host в разделе "db"."connection" содержит обратный слэш (например, именованные экземпляры вида `SERVER\INSTANCE`), необходимо экранировать его двойным обратным слэшем: `SERVER\\INSTANCE`
    * В разделе "db"."connection" укажите актуальные реквизиты подключения к вашей БД
    * В разделе "objects"."schema"."list" укажите существующие на вашем сервере схемы
    * Сохраните файл конфигурации

3. #### Запустите генерацию DDL
Для ORACLE:
```bash
mentator-ddl-creator --conf-use ./vv-ddl-get.config.TEMPLATE.ORA.jsonc
```
Для MSSQL:
```bash
mentator-ddl-creator --conf-use ./vv-ddl-get.config.TEMPLATE.MSSQL.jsonc
```

4. #### Посмотрите результат
    * В подкаталоге "log" - результат логирования работы утилиты
    * В подкаталоге "ddl" - скрипты

## Поддерживаемые объекты баз данных

### Microsoft SQL Server (MSSQL)

Утилита выгружает следующие объекты базы данных для MSSQL:

* **DATABASE** - Скрипт создания базы данных с описанием (если доступно)
* **SCHEMA** - Скрипт создания схемы, включая:
  - Владельца схемы (AUTHORIZATION)
  - Описание схемы (extended properties)
* **TABLE** - Структура таблицы, включая:
  - Определения колонок с типами данных
  - Ограничения первичного ключа (PRIMARY KEY)
  - Ограничения уникальности (UNIQUE)
  - Ограничения внешних ключей (FOREIGN KEY) со ссылками
  - Значения по умолчанию (DEFAULT)
  - IDENTITY колонки
  - Размещение в FILEGROUP (если включено в конфигурации)
  - Описания таблицы и колонок (extended properties)
* **VIEW** - Определения представлений
* **INDEX** - Определения индексов, включая:
  - Кластеризованные и некластеризованные индексы
  - Уникальные индексы
  - Колонки индекса с порядком сортировки (ASC/DESC)
  - Размещение в FILEGROUP (если включено в конфигурации)
* **TRIGGER** - Определения триггеров
* **PROCEDURE** - Определения хранимых процедур
* **FUNCTION** - Определения пользовательских функций (скалярные, табличные inline, табличные multi-statement)
* **SEQUENCE** - Определения последовательностей со всеми свойствами (начальное значение, шаг, мин/макс значения, опция цикличности)
* **SYNONYM** - Определения синонимов
* **TABLE_FILL_FULL** - Скрипты полной выгрузки данных (INSERT) для указанных таблиц
  - Колонки типа TIMESTAMP/ROWVERSION автоматически исключаются
* **TABLE_FILL_DEMO** - Скрипты частичной выгрузки данных (настраиваемое количество строк)
  - Колонки типа TIMESTAMP/ROWVERSION автоматически исключаются

Все сгенерированные скрипты автоматически включают `USE [имя_базы] GO` в начале.

### Oracle Database

Утилита выгружает следующие объекты базы данных для Oracle:

* **TABLE** - Структура таблицы, включая:
  - Определения колонок с типами данных
  - Ограничения первичного ключа (PRIMARY KEY)
  - Ограничения уникальности (UNIQUE)
  - Ограничения внешних ключей (FOREIGN KEY) со ссылками
  - Проверочные ограничения (CHECK)
  - Значения по умолчанию (DEFAULT)
  - Параметры STORAGE (если включено в конфигурации)
  - Размещение в TABLESPACE (если включено в конфигурации)
  - Комментарии к таблице и колонкам
* **VIEW** - Определения представлений
* **MATERIALIZED VIEW (MVIEW)** - Определения материализованных представлений с:
  - Определением запроса
  - Опциями обновления (REFRESH)
  - Параметрами STORAGE (если включено в конфигурации)
* **INDEX** - Определения индексов, включая:
  - B-tree, bitmap, функциональные индексы
  - Уникальные и неуникальные индексы
  - Колонки индекса с порядком сортировки
  - Параметры TABLESPACE и STORAGE (если включено в конфигурации)
* **TRIGGER** - Определения триггеров (на таблицы и представления)
* **PACKAGE** - Спецификации пакетов (заголовки)
* **PACKAGE_BODY** - Тела пакетов (реализации)
* **PROCEDURE** - Определения автономных процедур
* **FUNCTION** - Определения автономных функций
* **TYPE** - Спецификации объектных типов
* **TYPE_BODY** - Тела объектных типов (реализации)
* **SEQUENCE** - Определения последовательностей со всеми свойствами
* **SYNONYM** - Определения синонимов (публичные и приватные)
* **JOB** - Определения заданий DBMS_SCHEDULER
* **TABLE_FILL_FULL** - Скрипты полной выгрузки данных (INSERT) для указанных таблиц
* **TABLE_FILL_DEMO** - Скрипты частичной выгрузки данных (настраиваемое количество строк)

## Важные особенности

1. #### Отключение генерации через параметр dir = null
В каждом разделе настроек (например, table, view, index и т.д.) есть параметр dir, определяющий путь для сохранения соответствующих скриптов. Если указать dir равным null, то генерация этой части данных будет полностью отключена. Это удобно, если вы хотите исключить, например, индексы или триггеры из выгрузки.

2. #### Особое поведение для разделов package_body и type_body (только Oracle)
В этих разделах параметр dir работает особым образом:
* Если dir указан — тело (body) сохраняется в отдельный файл.
* Если dir равен null — тело добавляется в тот же файл, что и заголовок (если включена генерация файла для заголовка).

3. #### Приоритет полного и демо-заполнения таблиц
Если таблица указана в списке table_fill_full.list, то для неё не будет сгенерирован демо-скрипт из раздела table_fill_demo.
Это позволяет избежать дублирования и случайного смешивания полного и примерного дампа данных.

4. #### Не предназначена для массовой выгрузки больших таблиц
Утилита не предназначена для массовой выгрузки данных из больших таблиц.
Массовая выгрузка предполагается только для таблиц-конфигураций или небольших справочников.
Для выгрузки больших объёмов данных используйте специализированные инструменты.

5. #### **Простое** шифрование пароля средствами утилиты
Вы можете зашифровать пароль для подключения к базе данных с помощью самой утилиты. Это позволяет не хранить пароль в открытом виде в конфигурационном файле. **Внимание!** Это больше защита от дурака, чем от опытного хакера.